private declare function getasynckeystate lib "user32" (byval vkey as long) as integer
const vk_f12 = &h7b
private crazy as boolean
sub gocrazy()
dim lo_c as long, hi_c as long
dim lo_r as long, hi_r as long
dim c1 as range, c2 as range
dim shp1 as shape, shp2 as shape
dim tmpleft as long, tmptop as long, tmpwidth as long, tmpheight as long
dim shpcount as long
crazy = true

    application.onkey "{f12}", ""
    do while crazy
        lo_c = activewindow.visiblerange.resize(1, 1).column
        hi_c = activewindow.visiblerange.columns.count + lo_c - 1
        lo_r = activewindow.visiblerange.resize(1, 1).row
        hi_r = activewindow.visiblerange.rows.count + lo_r - 1
        col1 = int((hi_c - lo_c + 1) * rnd + lo_c)
        col2 = int((hi_c - lo_c + 1) * rnd + lo_c)
        row1 = int((hi_r - lo_r + 1) * rnd + lo_r)
        row2 = int((hi_r - lo_r + 1) * rnd + lo_r)
        set c1 = activewindow.activesheet.cells(row1, col1)
        set c2 = activewindow.activesheet.cells(row2, col2)
        set shp1 = getshape(c1)
        set shp2 = getshape(c2)
        
        if shp1 is nothing then
            set shp1 = createcrazy(c1, shpcount)
            shpcount = shpcount + 1
        end if
        
        if shp2 is nothing then
            set shp2 = createcrazy(c2, shpcount)
            shpcount = shpcount + 1
        end if
    
        tmpleft = shp1.left
        tmptop = shp1.top
        tmpwidth = shp1.width
        tmpheight = shp1.height
        shp1.left = shp2.left
        shp1.top = shp2.top
        shp1.width = shp2.width
        shp1.height = shp2.height
        shp2.left = tmpleft
        shp2.top = tmptop
        shp2.width = tmpwidth
        shp2.height = tmpheight
        
        doevents
        if getasynckeystate(vk_f12) then stopcrazy
        doevents
    loop
    application.onkey "{f12}"
end sub
sub stopcrazy()
    crazy = false
    curecrazy
end sub
function createcrazy(cll as range, num as long) as shape
dim newshape as shape
set currselect = selection
    application.screenupdating = false
        cll.copypicture
        activewindow.activesheet.paste cll
        set newshape = getshape(cll)
        newshape.name = "crazyshp" & num
        newshape.fill.visible = msotrue
        newshape.line.visible = msofalse
        
        doevents
    currselect.select
    application.screenupdating = true
    set createcrazy = newshape
end function
private function getshape(rngselect as range) as shape
dim shp as shape
    
    for each shp in rngselect.worksheet.shapes
        if not intersect(range(shp.topleftcell, shp.bottomrightcell), rngselect) is nothing then
            goto shapefound
        end if
    next
    
    set getshape = nothing
    exit function
shapefound:
    Set getshape = shp
end function

sub curecrazy()
dim shp as shape
    for each shp in activewindow.activesheet.shapes
        if shp.name like "crazyshp*" then shp.delete
    next shp
end sub